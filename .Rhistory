runExample("02_text")
library(foreign)
read.dct <- function(dct, labels.included = "yes") {
temp <- readLines(dct)
temp <- temp[grepl("_column", temp)]
switch(labels.included,
yes = {
pattern <- "_column\\(([0-9]+)\\)\\s+([a-z0-9]+)\\s+(.*)\\s+%([0-9]+)[a-z]\\s+(.*)"
classes <- c("numeric", "character", "character", "numeric", "character")
N <- 5
NAMES <- c("StartPos", "Str", "ColName", "ColWidth", "ColLabel")
},
no = {
pattern <- "_column\\(([0-9]+)\\)\\s+([a-z0-9]+)\\s+(.*)\\s+%([0-9]+).*"
classes <- c("numeric", "character", "character", "numeric")
N <- 4
NAMES <- c("StartPos", "Str", "ColName", "ColWidth")
})
temp_metadata <- setNames(lapply(1:N, function(x) {
out <- gsub(pattern, paste("\\", x, sep = ""), temp)
out <- gsub("^\\s+|\\s+$", "", out)
out <- gsub('\"', "", out, fixed = TRUE)
class(out) <- classes[x] ; out }), NAMES)
temp_metadata[["ColName"]] <- make.names(gsub("\\s", "", temp_metadata[["ColName"]]))
temp_metadata
}
read.dat <- function(dat, metadata_var, labels.included = "yes") {
read.fwf(dat, widths = metadata_var[["ColWidth"]], col.names = metadata_var[["ColName"]])
}
GSS_dta <- read.dta("/var/www/apps/olds/releases/2015-12-31_03-14/public/system/extracts/4457/Marriage/GSS.dta", convert.dates = TRUE, convert.factors = TRUE, missing.type = FALSE, convert.underscore = FALSE, warn.missing.labels = TRUE)
GSS_dta <- read.dta("GSS.dat", convert.dates = TRUE, convert.factors = TRUE, missing.type = FALSE, convert.underscore = FALSE, warn.missing.labels = TRUE)
GSS_dta <- read.dta("./data/GSS.dat", convert.dates = TRUE, convert.factors = TRUE, missing.type = FALSE, convert.underscore = FALSE, warn.missing.labels = TRUE)
GSS_dta <- read.dta("./data/GSS.dta", convert.dates = TRUE, convert.factors = TRUE, missing.type = FALSE, convert.underscore = FALSE, warn.missing.labels = TRUE)
GSS_dta <- read.dta("../data/GSS.dta", convert.dates = TRUE, convert.factors = TRUE, missing.type = FALSE, convert.underscore = FALSE, warn.missing.labels = TRUE)
GSS_metadata <- read.dct("./GSS.dct")
GSS_metadata <- read.dct(".data/GSS.dct")
GSS_metadata <- read.dct("./data/GSS.dct")
GSS_ascii <- read.dat("./data/GSS.dat", GSS_metadata)
attr(GSS_ascii, "col.label") <- GSS_metadata[["ColLabel"]]
GSS <- GSS_ascii
View(GSS)
sumarry(GSS)
summary(GSS)
library(dplyr)
dataset <- GSS %>% select(YEAR, MARITAL, AGEWED, DIVORCE, SPHRS2)
View(dataset)
write.csv(datatset, "GSSdata")
?wite.csv
?write.csv()
write.csv(dataset, "GSSdata")
tmpdataset <- filter(GSS, AGEWED > 8)
View(tmpdataset)
tmpdataset <- filter(dataset, AGEWED > 8)
write.csv(tmpdataset, "GSSdata")
summary(GSSdata)
read.csv(GSSdata)
getwd()
data <- read.csv("GSSdata")
summary(data)
ploy(data$SPHRS2)
plot(data$SPHRS2)
library(dplyr)
data <- filter(SPHRS2>1)
data <- filter(data,SPHRS2>1)
View(data)
data <- filter(data, SPHRS2<99)
View(data)
mean(data$SPHRS2)
plot(data$YEAR, data$DIVORCE)
library("readr")
install.packages("readr")
library("readr")
my.df = read_csv("https://raw.githubusercontent.com/sebastianbarfort/sds/master/data/marijuana-street-price-clean.csv")
library("ggplot2")
library("scales")
p = ggplot(my.df, aes(x = date, y = HighQ))
p = p + geom_point(alpha = .05) # add points
p = p + geom_line() # add points
p = p + geom_smooth(colour = "red")
p = p + facet_wrap(~ State, scales = "free_y")
p = p + scale_x_date(breaks = pretty_breaks(4))
p = p + labs(x = NULL, y = "Price ($)", title = "Price of Marijuana")
p
View(my.df)
str(my.df)
class(my.df)
data <- tbl_df((my.df))
daya
data
data <- filter(data, -c(HighQN, MedQN, LowQN))
data <- select(data, -c(HighQN, MedQN, LowQN))
data
dataByMonth <- data %>% group_by(State, date)
View(dataByMonth)
dataByMonth <- group_by(State, date())
dataByMonth <- data %>% group_by(State, date())
View(dataByMonth)
dataByMonth <- data %>% group_by(State, date)
plot(data$date, data$State="Maryland")
dataMD <- data %>% filter(State=Maryland)
dataMD <- data %>% filter(State="Maryland")
View(data)
dataMD <- filter(data, State="Maryland")
data_MD <- filter(data, State=="Maryland")
View(data_MD)
data_MD <- arrange(data_MD, date)
View(data_MD)
plot(data_MD$date, data_MD$HighQ)
library(lubridate)
rawData = read_csv("https://raw.githubusercontent.com/sebastianbarfort/sds/master/data/marijuana-street-price-clean.csv")
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
View(data)
data$monthYearCol <- mutate(paste(month(date, label=TRUE), " - ", Year(date))
)
tmpdate <- as.date(2012-01-01)
tmpdate <- as.date(2012-01-01)
tmpdate <- as.Date(2012-01-01)
tmpdate <- as.Date("2012-01-01")
year <- Year(tmpdate)
year <- year(tmpdate)
month <- month(tmpdate)
comb <- paste(month, year, sep = " - ")
month <- month(tmpdate, label=TRUE)
comb <- paste(month, year, sep = " - ")
createDateFormat <- function{}
formatDateFunction <- function(tmpDate){
tmpMonth <- month(tmpDate, labels=TRUE)
tmpYear <- year(tmpDate)
return(paste(tmpMonth, tmpYear, sep = "-"))
}
formatDateFunction(tmpDate)
year <- year(tmpdate)
month <- month(tmpdate, label=TRUE)
comb <- paste(month, year, sep = " - ")
comb <- paste(month, year, sep = "-")
formatDateFunction <- function(tmpDate){
tmpMonth <- month(tmpDate, labels=TRUE)
tmpYear <- year(tmpDate)
return(paste(tmpMonth, tmpYear, sep = "-"))
}
formatDateFunction(tmpDate)
formatDateFunction <- function(tmpDate, ...){
tmpMonth <- month(tmpDate, labels=TRUE)
tmpYear <- year(tmpDate)
return(paste(tmpMonth, tmpYear, sep = "-"))
}
formatDateFunction(tmpDate)
formatDateFunction <- function(tmpDate){
#tmpMonth <- month(tmpDate, labels=TRUE)
tmpYear <- year(tmpDate)
return(paste(tmpMonth, tmpYear, sep = "-"))
}
formatDateFunction(tmpDate)
formatDateFunction(2012-01-01)
formatDateFunction(as.Date(2012-01-01))
aDate <- as.Date("2012-01-01")
formatDateFunction(as.Date("2012-01-01"))
formatDateFunction <- function(tmpDate){
tmpMonth <- month(tmpDate, labels=TRUE)
tmpYear <- year(tmpDate)
(paste(tmpMonth, tmpYear, sep = "-"))
}
formatDateFunction(as.Date("2012-01-01"))
formatDateFunction <- function(tmpDate){
tmpMonth <- month(tmpDate)
tmpYear <- year(tmpDate)
(paste(tmpMonth, tmpYear, sep = "-"))
}
formatDateFunction(as.Date("2012-01-01"))
formatDateFunction <- function(tmpDate){
tmpMonth <- lubridate::month(tmpDate, labels = TRUE)
tmpYear <- lubridate::year(tmpDate)
(paste(tmpMonth, tmpYear, sep = "-"))
}
formatDateFunction(as.Date("2012-01-01"))
month.Name(as.Date("12-02-02"))
month.abb(as.Date("12-02-02"))
month.name(12)
am <- format(asDate("12-02-02"), %B)
am <- format(asDate("12-02-02"), format = "%B")
am <- format(as.Date("12-02-02"), format = "%B")
formatDateFunction <- function(tmpDate){
#tmpMonth <- month(tmpDate, labels = TRUE)
tmpMonth <- format(tmpDate, format = "%B")
tmpYear <- year(tmpDate)
(paste(tmpMonth, tmpYear, sep = "-"))
}
formatDateFunction(as.Date("2012-01-01"))
formatDateFunction <- function(tmpDate){
#tmpMonth <- month(tmpDate, labels = TRUE)
tmpMonth <- format(tmpDate, format = "%B")
#tmpYear <- year(tmpDate)
tmpYear <- format(tmpDate, format = "%Y")
(paste(tmpMonth, tmpYear, sep = "-"))
}
formatDateFunction(as.Date("2012-01-01"))
library("dplyr")
library("ggplot2")
library("scales")
library("readr")
rawData = read_csv("https://raw.githubusercontent.com/sebastianbarfort/sds/master/data/marijuana-street-price-clean.csv")
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
View(data)
formatDateFunction <- function(tmpDate){
tmpMonth <- format(tmpDate, format = "%B")
tmpYear <- format(tmpDate, format = "%Y")
(paste(tmpMonth, tmpYear, sep = "-"))
}
mutate(data, MonthYear = formatDateFunction(date))
View(data)
data <- mutate(data, MonthYear = formatDateFunction(date))
View(data)
arrange(data, State, MonthYear)
data <- arrange(data, State, MonthYear)
group_by(data, State, MonthYear)
data_MD <- filter(data, State=="Maryland")
View(data_MD)
data_MD <- summarize(data_MD, avePrice = mean(HighQ, na.rm=TRUE))
View(data)
data %>%
group_by(State) %>%
summarise(
m.price = mean(HighQ, na.rm = TRUE)
) %>%
arrange(desc(m.price))
View(data)
data %>%
group_by(MonthYear) %>%
summarise(
meanprice = mean(HighQ, na.rm = TRUE)
) %>%
arrange(desc(m.price))
data %>%
group_by(MonthYear) %>%
summarise(
meanprice = mean(HighQ, na.rm = TRUE)
) %>%
arrange(desc(meanprice))
data_MD <- data %>%
group_by(MonthYear) %>%
summarise(
meanprice = mean(HighQ, na.rm = TRUE)
) %>%
arrange(desc(meanprice))
View(data_MD)
p = ggplot(data, aes(x = MonthYear, y = meanprice))
p = p + geom_point(alpha = .05) # add points
p = p + geom_line() # add points
p = p + geom_smooth(colour = "red")
p
p = ggplot(data_MD, aes(x = MonthYear, y = meanprice))
p = p + geom_point(alpha = .05) # add points
p = p + geom_line() # add points
p = p + geom_smooth(colour = "red")
p
n
p = ggplot(data_MD, aes(x = MonthYear, y = meanprice))
p
p = p + geom_line() # add points
p
p = ggplot(data_MD, aes(x = MonthYear, y = meanprice)) + geom_line()
p
p = ggplot(data = data_MD, aes(x = MonthYear, y = meanprice)) + geom_line()
p
class(data_MD$MonthYear)
data_MD$MonthYear <- as.Date(data_MD$MonthYear)
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
View(data)
class(data$date)
data$date <- format(data$date, format = "%B" "-" "%Y")
data$date <- format(data$date, format = "%B/%Y")
data$date <- format(data$date, format = "%B %Y")
View(data)
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
data$date <- format(data$date, format = "%B %Y")
View(data)
data <- arrange(data, State, date)
data_MD <- filter(data, State=="Maryland")
View(data_MD)
data_MD <- arrange(data_MD, date)
View(data_MD)
data_MD <- data %>%
group_by(date) %>%
summarise(
meanprice = mean(HighQ, na.rm = TRUE)
) %>%
)
data_MD <- data %>%
group_by(date) %>%
summarise(
meanprice = mean(HighQ, na.rm = TRUE)
)# %>%
View(data_MD)
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
data$date <- format(data$date, format = "%B %Y")
data_MD <- filter(data, State=="Maryland")
data_MD <- data %>%
group_by(date) %>%
summarise(
meanprice = mean(HighQ, na.rm = TRUE)
) %>%
arrange(desc(date))
View(data_MD)
class(data_MD$date)
data <- tbl_df((rawData))
str(rawData)
data <- select(data, -c(HighQN, MedQN, LowQN))
str(data)
data$date <- format(data$date, format = "%B %Y")
str(data)
data$date <- as.Date(format(data$date, format = "%B %Y"))
data_MD <- filter(data, State=="Maryland")
View(data_MD)
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
data_MD <- filter(data, State=="Maryland")
View(data_MD)
as.Date(data$date) <- format(data$date, format = "%B %Y") changes date to character
str(data)
data$date <- format(data$date, format = "%B %Y") changes date to character
data$date <- format(data$date, format = "%B %Y") #change to character from date class
str(data)
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
data$date = as.Date(as.character(data$dATE), format="%B%Y")
data$date = as.Date(as.character(data$date), format="%B%Y")
View(data)
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
data$date <- as.Date(format(data$date, format = "%B %Y")) #change to character from date class
data$date <- as.Date(format(data$date, format = "%B%Y")) #change to character from date class
aggregate(data$date, format(time(data$date), "%m %d"), sum)
log <- data.frame(Date = c("2013/05/25","2013/05/28","2013/05/31","2013/06/01","2013/06/02","2013/06/05","2013/06/07"),
Quantity = c(9,1,15,4,5,17,18))
str(log)
View(log)
log$Date <- as.Date(log$Date, "%Y/%m/%d")
View(log)
str(log)
log$Month <- as.Date(cut(log$Date, breaks = "month"))
log$Week <- as.Date(cut(log$Date, breaks = "week", start.on.monday = FALSE)) # changes weekly break point to Sunday
str(log)
rawData = read_csv("https://raw.githubusercontent.com/sebastianbarfort/sds/master/data/marijuana-street-price-clean.csv")
rawData = read_csv("https://raw.githubusercontent.com/sebastianbarfort/sds/master/data/marijuana-street-price-clean.csv")
data <- tbl_df((rawData))
data <- select(data, -c(HighQN, MedQN, LowQN))
data$Month <- as.Date(cut(data$date, breaks = "month"))
data$Week <- as.Date(cut(data$date, breaks = "week", start.on.monday = TRUE)) # changes weekly break point to Sunday
str(data)
data_MD <- filter(data, State=="Maryland")
ggplot(data = data_MD,
aes(Month, HighQ)) +
stat_summary(fun.y = sum, # adds up all
ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "line") + # or "line"
scale_x_date(
labels = date_format("%Y-%m"),
breaks = "1 month") # custom x-axis labels
library("scales")
library("ggplot2")
ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "line") + # or "line"
scale_x_date(
labels = date_format("%Y-%m"),
breaks = "1 month") # custom x-axis labels
log <- data.frame(Date = c("2013/05/25","2013/05/28","2013/05/31","2013/06/01","2013/06/02","2013/06/05","2013/06/07"),
Quantity = c(9,1,15,4,5,17,18))
log$Date <- as.Date(log$Date, "%Y/%m/%d")
log$Month <- as.Date(cut(log$Date, breaks = "month"))
log$Week <- as.Date(cut(log$Date, breaks = "week", start.on.monday = FALSE)) # changes weekly break point to Sunday
ggplot(data = log,
aes(Month, Quantity)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "bar") + # or "line"
scale_x_date(
labels = date_format("%Y-%m"),
breaks = "1 month") # custom x-axis labels
library(ggplot2)
library(scales)
log <- data.frame(Date = c("2013/05/25","2013/05/28","2013/05/31","2013/06/01","2013/06/02","2013/06/05","2013/06/07"),
Quantity = c(9,1,15,4,5,17,18))
log$Date <- as.Date(log$Date,
"%Y/%m/%d") # tabulate all the options here
log$Month <- as.Date(cut(log$Date,
breaks = "month"))
log$Week <- as.Date(cut(log$Date,
breaks = "week",
start.on.monday = FALSE)) # changes weekly break point to Sunday
ggplot(data = log,
aes(Month, Quantity)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "bar") + # or "line"
scale_x_date(
labels = date_format("%Y-%m"),
breaks = "1 month") # custom x-axis labels
ggplot(data = log,
aes(Week, Quantity)) +
stat_summary(fun.y = sum, # adds up all observations for the week
geom = "bar") + # or "line"
scale_x_date(
labels = date_format("%Y-%m-%d"),
breaks = "1 week") # custom x-axis labels
ggplot(data = log,
aes(Month, Quantity)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "bar") + # or "line"
scale_x_date(breaks = date_breaks("1 month")
ggplot(data = log,
aes(Month, Quantity)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "bar") + # or "line"
scale_x_date(breaks = date_breaks("1 month"))
ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "line") + # or "line"
scale_x_date(breaks = date_breaks("1 month"))
ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "line") + # or "line"
scale_x_date(breaks = date_breaks("1 month"), labels = date_format("%Y-%m"))
ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "line") + # or "line"
scale_x_date(breaks = date_breaks("1 month"), labels = date_format("%Y-%m") +
geom_smooth(color="blue"))
ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "line") + # or "line"
scale_x_date(breaks = date_breaks("1 month"), labels = date_format("%Y-%m"))
monthplot <- ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, # adds up all observations for the month
geom = "line") + # or "line"
scale_x_date(breaks = date_breaks("1 month"), labels = date_format("%Y-%m"))
monthplot = monthplot + geom_smooth(colour = "red")
monthplot
monthplot <- ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, geom = "line") + # or "line"
scale_x_date(breaks = date_breaks("1 month"), labels = date_format("%Y-%m"))
monthplot
monthplot <- ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, geom = "line") + geom_smooth(colour = "red") +# or "line"
scale_x_date(breaks = date_breaks("1 month"), labels = date_format("%Y-%m"))
monthplot <- ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, geom = "line") +geom_point(alpha = .05) +# or "line"
scale_x_date(breaks = date_breaks("1 month"), labels = date_format("%Y-%m"))
monthplot
monthplot <- ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, geom_smooth = color="red") +
scale_x_date(breaks = date_breaks("1 month"), labels = date_format("%Y-%m"))
last_month <- Sys.Date() - 0:29
df <- data.frame(
date = last_month,
price = runif(30)
)
base <- ggplot(df, aes(date, price)) +
geom_line()
base
base + scale_x_date(date_labels = "%b %d")
base
base + scale_x_date(date_breaks = "1 week", date_labels = "%W")
base
base + scale_x_date(date_minor_breaks = "1 day")
base
# Set limits
base + scale_x_date(limits = c(Sys.Date() - 7, NA))
base
base + scale_x_date(date_labels = "%b %d")
base
last_month <- Sys.Date() - 0:29
df <- data.frame(
date = last_month,
price = runif(30)
)
base <- ggplot(df, aes(date, price)) +
geom_line()
base
base + scale_x_date(date_labels = "%b %d")
base
base + scale_x_date(date_breaks = "1 week", date_labels = "%W")
base
base + scale_x_date(date_minor_breaks = "1 day")
base
# Set limits
base + scale_x_date(limits = c(Sys.Date() - 7, NA))
monthplot <- ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, geom = "line") +
scale_x_date(breaks = date_breaks("3 month"), labels = date_format("%Y-%m"))
monthplot
monthplot <- ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, geom = "line") +
scale_x_date(breaks = date_breaks("3 month"), labels = date_format("%m-%Y"))
monthplot
monthplot <- ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = sum, geom = "line") +
scale_x_date(breaks = date_breaks("3 month"), labels = date_format("%m-%Y")) +
labs(y = "Marijuana Aver Monthly Price")
monthplot
str(data_MD)
monthplot <- ggplot(data = data, aes(Month, HighQ)) +
stat_summary(fun.y = mean, geom = "line") +
scale_x_date(breaks = date_breaks("3 month"), labels = date_format("%m-%Y")) +
labs(y = "Marijuana Aver Monthly Price")
monthplot
